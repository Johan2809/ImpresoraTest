package controllers;

import application.Aplicacion;
import javafx.embed.swing.SwingFXUtils;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.stage.FileChooser;
import javafx.scene.control.Label;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.layout.VBox;

import javax.imageio.ImageIO;
import javax.swing.*;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

public class VentanaImpresionController {

    @FXML
    private Button btnImprimir;

    @FXML
    private Button btnBuscar;

    private Aplicacion aplicacion;

    @FXML
    private Label lblArchivoSeleccionado;

    @FXML
    private ImageView imageView;

    @FXML
    void BuscarArchivo(ActionEvent event) {
        FileChooser fileChooser = new FileChooser();
        File archivoSeleccionado = fileChooser.showOpenDialog(aplicacion.getPrimaryStage());

        if (archivoSeleccionado != null) {
            lblArchivoSeleccionado.setText("Archivo seleccionado: " + archivoSeleccionado.getAbsolutePath());
            Image imagen = new Image(archivoSeleccionado.toURI().toString());
            imageView.setImage(imagen);
        }
    }

    @FXML
    void mostrarVistaPrevia(ActionEvent event) {
        String archivoSeleccionado = lblArchivoSeleccionado.getText().replace("Archivo seleccionado: ", "");
        if (!archivoSeleccionado.isEmpty()) {
            File file = new File(archivoSeleccionado);
            if (file.exists()) {
                BufferedImage bufferedImage;
                try {
                    bufferedImage = ImageIO.read(file);
                    Image imagen = SwingFXUtils.toFXImage(bufferedImage, null);
                    imageView.setImage(imagen);
                    imageView.setFitWidth(500);
                    imageView.setFitHeight(500);
                    imageView.setPreserveRatio(true);
                    VBox vbox = new VBox(imageView);
                    javafx.scene.Scene scene = new javafx.scene.Scene(vbox);
                    javafx.stage.Stage stage = new javafx.stage.Stage();
                    stage.setTitle("Vista previa de imagen");
                    stage.setScene(scene);
                    stage.show();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            } else {
                JOptionPane.showMessageDialog(null, "El archivo seleccionado no existe.");
            }
        } else {
            JOptionPane.showMessageDialog(null, "No se ha seleccionado ningún archivo.");
        }
    }

    @FXML
    void ImprimirArchivo(ActionEvent event) {
        String archivoSeleccionado = lblArchivoSeleccionado.getText().replace("Archivo seleccionado: ", "");
        // Implementar la lógica para imprimir el archivo seleccionado
        if (!archivoSeleccionado.isEmpty()) {
            JOptionPane.showMessageDialog(null, "Imprimiendo");
        }
    }

    public void setAplicacion(Aplicacion aplicacion) {
        this.aplicacion = aplicacion;
    }
}
